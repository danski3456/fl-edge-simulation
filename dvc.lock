schema: '2.0'
stages:
  download_data:
    cmd: python src/setup/download_dataset.py
    deps:
    - path: src/datasets
      md5: 2b0d12b1d449603e806f279c71d95bdc.dir
      size: 9676
      nfiles: 6
    - path: src/setup/download_dataset.py
      md5: 1f33bd10e776c5ab04e875d1799e55dc
      size: 163
    params:
      params.yaml:
        dataset_name: mnist
    outs:
    - path: assets/raw_datasets/mnist
      md5: 433c86703301f4aa5219ff51e391b3d1.dir
      size: 243973592
      nfiles: 20
  original_assignment:
    cmd: python src/setup/generate_assignment.py
    deps:
    - path: assets/raw_datasets/mnist
      md5: 433c86703301f4aa5219ff51e391b3d1.dir
      size: 243973592
      nfiles: 20
    - path: src/setup/generate_assignment.py
      md5: 4597252257ff3e356de098e73a2059af
      size: 3622
    params:
      params.yaml:
        arrival_rate:
          type: constant
          quantity: 100
        dataset_name: mnist
        iid: false
        num_clients: 9
        optimal_data_sharing:
          topology: ring
          edge_capacity: 1000
          multi-timeslot: false
        timeslots: 50
    outs:
    - path: assets/original_assignment/mnist/original_assignment.csv
      md5: e899ace13740e507daaf1d9658e52307
      size: 635489
  final_assignment:
    cmd: python src/policies/apply.py
    deps:
    - path: assets/original_assignment/mnist/
      md5: ac8c867f3d2f4e57b51df6c071459e99.dir
      size: 635514
      nfiles: 2
    - path: src/policies/
      md5: 24e65df0fc5b9ac8a232895bf6684fc5.dir
      size: 19301
      nfiles: 9
    params:
      params.yaml:
        cache_capacity:
          type: constant
          quantity: 500000
        dataset_name: mnist
        fl_rounds:
          type: all
          freq: 1
        max_resources: 100000
        num_clients: 9
        resources:
          placeholder: none
        timeslots: 50
        topology: none
    outs:
    - path: assets/final_assignment/mnist/final_assignment.json
      md5: cf1cc1cd64a95207672343f90672a09f
      size: 23784329
  simulate:
    cmd: python src/simulations/federated_learning.py && python src/simulations/central_server.py
    deps:
    - path: assets/final_assignment/mnist/
      md5: 7798db8385b5e0ba14f55e1ec2a573b0.dir
      size: 23784352
      nfiles: 2
    - path: src/flower/
      md5: ce487286665f2f7e4a2a6e12ce1c8534.dir
      size: 10384
      nfiles: 4
    - path: src/simulations/
      md5: 5754e4806f95ae52c301b7a1d4df8f5c.dir
      size: 2401
      nfiles: 2
    params:
      params.yaml:
        dataset_name: mnist
        fl_rounds:
          type: all
          freq: 1
        model_name: mnist_conv
        num_clients: 9
    outs:
    - path: assets/metrics/train
      md5: 8e34e1c5ff619e2d656d7f5d93ffb99f.dir
      size: 103835
      nfiles: 11
    - path: assets/models/
      md5: c0c1ad8c9a27d4f4c017afe22cba36d1.dir
      size: 234452
      nfiles: 2
  report:
    cmd: python src/reports/data_distributions.py && python src/reports/training.py
      && python src/reports/confusion_matrix.py
    deps:
    - path: assets/metrics/train
      md5: 8e34e1c5ff619e2d656d7f5d93ffb99f.dir
      size: 103835
      nfiles: 11
    - path: src/reports
      md5: 2b4d46aaa669d0bf68c19afa6d0057ab.dir
      size: 6442
      nfiles: 3
    params:
      params.yaml:
        dataset_name: mnist
        num_clients: 9
    outs:
    - path: assets/metrics/test/central/metrics.json
      md5: a42cfdec26a8c9bc723143598789c352
      size: 39
    - path: assets/metrics/test/federated/metrics.json
      md5: 171f5e49cd95940fe3df31ca331a45f1
      size: 39
    - path: assets/reports/images/mnist
      md5: 3c8361ca1751ff0dc17bc1c9e0193059.dir
      size: 302706
      nfiles: 6
