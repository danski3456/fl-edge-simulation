schema: '2.0'
stages:
  download_data:
    cmd: python src/setup/download_dataset.py
    deps:
    - path: src/datasets
      md5: 2b0d12b1d449603e806f279c71d95bdc.dir
      size: 9676
      nfiles: 6
    - path: src/setup/download_dataset.py
      md5: 1f33bd10e776c5ab04e875d1799e55dc
      size: 163
    params:
      params.yaml:
        dataset_name: mnist
    outs:
    - path: assets/raw_datasets/mnist
      md5: 2d682a3f07d0416027ea30bbab873e16.dir
      size: 243973592
      nfiles: 20
  original_assignment:
    cmd: python src/setup/generate_assignment.py
    deps:
    - path: assets/raw_datasets/mnist
      md5: 2d682a3f07d0416027ea30bbab873e16.dir
      size: 243973592
      nfiles: 20
    - path: src/setup/generate_assignment.py
      md5: 571beb781af247a2b4b1a6d3423fec12
      size: 4337
    params:
      params.yaml:
        arrival_rate:
          type: constant
          quantity: 100
        dataset_name: mnist
        exp_name: base
        iid: false
        iid_score: 2
        num_clients: 9
        optimal_data_sharing:
          topology: ring
          edge_capacity: 1000
          multi-timeslot: false
        timeslots: 50
    outs:
    - path: assets/base/original_assignment/mnist/original_assignment.csv
      md5: 4563ab0c1f070a610da49d54c553b0a7
      size: 743504
  final_assignment:
    cmd: python src/policies/apply.py
    deps:
    - path: assets/base/original_assignment/mnist/
      md5: b74ce675c0c9a3f7ca1ec0ea46208217.dir
      size: 743529
      nfiles: 2
    - path: src/policies/
      md5: 24e65df0fc5b9ac8a232895bf6684fc5.dir
      size: 19301
      nfiles: 9
    params:
      params.yaml:
        cache_capacity:
          type: constant
          quantity: 500000
        dataset_name: mnist
        exp_name: base
        fl_rounds:
          type: all
          freq: 1
        max_resources: 100000
        num_clients: 9
        resources:
          placeholder: none
        timeslots: 50
        topology: none
    outs:
    - path: assets/base/final_assignment/mnist/final_assignment.json
      md5: d44291e2f5d4c2ae2e8b755ab603c3aa
      size: 26560729
  simulate:
    cmd: python src/simulations/federated_learning.py && python src/simulations/central_server.py
    deps:
    - path: assets/base/final_assignment/mnist/
      md5: 34a2a25fc668922336f4330e12aedeaa.dir
      size: 26560752
      nfiles: 2
    - path: src/flower/
      md5: 97cc9c369644d7e7b9b46e88a2fe2ee5.dir
      size: 10384
      nfiles: 4
    - path: src/simulations/
      md5: 5754e4806f95ae52c301b7a1d4df8f5c.dir
      size: 2401
      nfiles: 2
    params:
      params.yaml:
        dataset_name: mnist
        exp_name: base
        fl_rounds:
          type: all
          freq: 1
        model_name: mnist_conv
        num_clients: 9
    outs:
    - path: assets/base/metrics/train
      md5: 27f0ab35d6be46f0714503ebbf4e6e56.dir
      size: 103678
      nfiles: 11
    - path: assets/base/models/
      md5: 96e07234e531d2e474405e6c11cf8c6c.dir
      size: 234452
      nfiles: 2
  report:
    cmd: python src/reports/data_distributions.py && python src/reports/training.py
      && python src/reports/confusion_matrix.py
    deps:
    - path: assets/base/metrics/train
      md5: 27f0ab35d6be46f0714503ebbf4e6e56.dir
      size: 103678
      nfiles: 11
    - path: src/reports
      md5: 2b4d46aaa669d0bf68c19afa6d0057ab.dir
      size: 6442
      nfiles: 3
    params:
      params.yaml:
        dataset_name: mnist
        exp_name: base
        num_clients: 9
    outs:
    - path: assets/base/metrics/test/central/metrics.json
      md5: eb3b3c8b26bb63e4c7e6ec2b87aeaf9e
      size: 39
    - path: assets/base/metrics/test/federated/metrics.json
      md5: 8f08817048c1b7bb77b79f8907d79d66
      size: 39
    - path: assets/base/reports/images/mnist
      md5: 0e29be45d6c395fa30d20d05da35ffed.dir
      size: 280230
      nfiles: 6
